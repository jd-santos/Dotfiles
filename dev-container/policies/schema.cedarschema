// =============================================================================
// Cedar Schema for Dev Container Authorization
// =============================================================================
// Defines the types used in our authorization policies.
// These policies will be enforced by Leash when integrated.
//
// For more information on Cedar policy language:
// https://www.cedarpolicy.com/
// =============================================================================

namespace DevContainer {
    // =========================================================================
    // Entity Types
    // =========================================================================
    
    // Agent: The container/process making requests
    entity Agent;
    
    // Repository: A Git repository
    entity Repository {
        name: String,
    };
    
    // Branch: A Git branch within a repository
    entity Branch {
        name: String,
        repository: String,
    };
    
    // File: A file or directory path
    entity File {
        path: String,
    };
    
    // Tool: An executable command or binary
    entity Tool {
        name: String,
    };
    
    // URL: A network endpoint
    entity URL {
        host: String,
        port: Long,
    };

    // =========================================================================
    // Actions
    // =========================================================================
    
    // Git operations
    action git_clone appliesTo {
        principal: [Agent],
        resource: [Repository]
    };
    
    action git_push appliesTo {
        principal: [Agent],
        resource: [Branch]
    };
    
    action git_pull appliesTo {
        principal: [Agent],
        resource: [Repository]
    };
    
    // File operations
    action file_read appliesTo {
        principal: [Agent],
        resource: [File]
    };
    
    action file_write appliesTo {
        principal: [Agent],
        resource: [File]
    };
    
    action file_delete appliesTo {
        principal: [Agent],
        resource: [File]
    };
    
    // Command execution
    action execute_command appliesTo {
        principal: [Agent],
        resource: [Tool]
    };
    
    // Network operations
    action network_request appliesTo {
        principal: [Agent],
        resource: [URL]
    };
}
