# Enable 256-color and true-color (24 bit)
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc" # Override to enable true-color

# Color Palette - Dracula Theme
bg='#282a36'           # Background
fg='#f8f8f2'           # Foreground
light='#f8f8f2'        # Light text
neutral='#44475a'      # Neutral / Selection
muted='#6272a4'        # Muted / Comment
purple='#bd93f9'       # Accent
cyan='#8be9fd'         # Info
green='#50fa7b'        # Success
yellow='#f1fa8c'       # Warning
red='#ff5555'          # Error


# Set prefix to Ctrl+O - ergonomic for right-hand Ctrl users
# Press Ctrl+O to activate tmux command mode
set -g prefix C-o
unbind C-b

# Allow sending the prefix key through to nested sessions or applications
# Double-pressing the prefix sends the actual key combination to the active pane
# Useful for: nested tmux sessions, or apps that also use the same key binding
bind C-o send-prefix

# Enable mouse support
set -g mouse on

# Use system clipboard
set -g set-clipboard on

# QOL improvements
set -g pane-base-index 1        # Match window base-index
set -g renumber-windows on      # No gaps when closing windows
set -sg escape-time 10          # Faster key response (helps vim)
set -g history-limit 10000      # More scrollback
set -g focus-events on          # Better neovim integration
set -g display-panes-time 3000  # Show pane numbers for 3 seconds
set -g status-interval 5        # Refresh status bar every 5 seconds

# Status bar styling
set -g status-position top
set -g status-left-length 100
set -g status-right-length 100
set -g status-style "fg=$light,bg=$neutral"
set -g status-left "#[fg=${purple},bold]   #S #[fg=$light,nobold] | "
set -g status-right "#[fg=${cyan}]   #(cd #{pane_current_path} && git branch --show-current 2>/dev/null || echo 'no branch') #[fg=${muted}]| #[fg=${yellow}] 󰃭 %b %d "
set -g window-status-current-format "#[fg=${green},bold]   #[underscore]#I:#W"
set -g window-status-format " #I:#W"

# Window activity indicators
set -g monitor-activity on
set -g visual-activity off
set -g window-status-activity-style "fg=${yellow},bold"

# Border styling
set -g pane-border-style "fg=${neutral}"
set -g pane-active-border-style "fg=${purple}"

# Message styling
set -g message-style "fg=${muted}"

# Session styling
set -g mode-style "fg=${light}, bg=${muted}"

# Copy mode styling
set -g copy-mode-match-style "fg=${bg},bg=${yellow}"
set -g copy-mode-current-match-style "fg=${bg},bg=${green},bold"

# Vim-style copy mode
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Window indexing
set -g base-index 1

# Vim-like pane navigation with prefix + hjkl
# Press prefix (Ctrl+O) then h/j/k/l to move between panes
bind h select-pane -L  # Left
bind j select-pane -D  # Down
bind k select-pane -U  # Up
bind l select-pane -R  # Right

# Vim-like pane resizing with prefix + Shift + hjkl (repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick window switching with Option+number (requires macos-option-as-alt = true in Ghostty)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Split panes with | and - (more intuitive than " and %)
bind | split-window -h -c "#{pane_current_path}"  # Vertical split (side-by-side)
bind - split-window -v -c "#{pane_current_path}"  # Horizontal split (top-bottom)

# File Preview - Open fzf popup with bat preview
# Press Ctrl+f to open the popup
# Press Enter on a file to open it in vim in the underlying pane
bind C-f display-popup -w 80% -h 80% -E "fzf --preview 'bat --style=numbers --color=always --line-range :500 {}' --print0 | xargs -0 -I {} tmux send-keys -t '#{pane_id}' 'vim {}' Enter"

# Close pane
bind x kill-pane

# Reload configuration
unbind r
bind r source-file ~/.tmux.conf
